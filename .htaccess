# Protección de IP y Seguridad - FRIOCAS Web

# Ocultar información del servidor
ServerTokens Prod
ServerSignature Off

# Proteger contra ataques comunes
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Bloquear acceso a archivos sensibles
    RewriteRule ^(\.htaccess|\.htpasswd|\.git|\.env|config\.php|database\.php)$ - [F,L]
    
    # Bloquear user agents maliciosos
    RewriteCond %{HTTP_USER_AGENT} ^$ [OR]
    RewriteCond %{HTTP_USER_AGENT} ^(java|curl|wget) [NC,OR]
    RewriteCond %{HTTP_USER_AGENT} ^.*(libwww-perl|curl|wget|python|nikto|scan) [NC,OR]
    RewriteCond %{HTTP_USER_AGENT} ^.*(winhttp|HTTrack|clshttp|archiver|loader|email|harvest|extract|grab|miner) [NC]
    RewriteRule .* - [F,L]
    
    # Bloquear IPs maliciosas (ejemplo)
    # RewriteCond %{REMOTE_ADDR} ^(192\.168\.1\.100|10\.0\.0\.50)$
    # RewriteRule .* - [F,L]
</IfModule>

# Headers de seguridad
<IfModule mod_headers.c>
    # Ocultar información del servidor
    Header always unset X-Powered-By
    Header always unset X-AspNet-Version
    Header always unset X-AspNetMvc-Version
    
    # Protección XSS
    Header always set X-XSS-Protection "1; mode=block"
    
    # Prevenir MIME sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Protección contra clickjacking
    Header always set X-Frame-Options "DENY"
    
    # Política de referrer
    Header always set Referrer-Policy "no-referrer"
    
    # Content Security Policy
    Header always set Content-Security-Policy "default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; img-src 'self' https: data: blob:;"
    
    # Cache control para archivos sensibles
    <FilesMatch "\.(html|css|js|json)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
</IfModule>

# Proteger archivos sensibles
<FilesMatch "^(\.htaccess|\.htpasswd|\.git|\.env|config\.js|script\.js)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Comprimir archivos
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Cache para archivos estáticos
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresDefault "access plus 2 days"
</IfModule>

# Bloquear acceso a directorios
Options -Indexes

# Proteger contra hotlinking
RewriteEngine On
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?friocas.com [NC]
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?netlify.app [NC]
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?github.com [NC]
RewriteRule \.(jpg|jpeg|png|gif|css|js)$ - [F,L]
